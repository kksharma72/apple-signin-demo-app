<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Home Page - Sign In with Apple Demo</title>
  <meta name="appleid-signin-client-id" content="com.princessauto.dev">
  <meta name="appleid-signin-scope" content="email name">
  <meta name="appleid-signin-redirect-uri" content="https://apple-signin-demo-app.onrender.com/callback">
  <meta name="appleid-signin-state" content="your_unique_state_value_for_this_request">
  <script type="text/javascript" src="https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js"></script>
</head>
<body>
  <h1>Welcome to the Home Page!</h1>
  <p>Please sign in to continue.</p>

  <div id="appleid-signin"
       data-color="black"
       data-border="true"
       data-type="sign-in"
       data-client-id="com.princessauto.dev"
       data-scope="email name"
       data-redirect-uri="https://apple-signin-demo-app.onrender.com/callback"
       data-state="your_unique_state_value_for_this_request"
       data-response-mode="form_post"
  ></div>

  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', () => {
      console.log('Home page DOM Content Loaded. Initializing AppleID.auth for redirect flow...');

      AppleID.auth.init({
        clientId: 'com.princessauto.dev',
        scope: 'name email',
        redirectURI: 'https://apple-signin-demo-app.onrender.com/callback',
        state: 'your_unique_state_value_for_this_request', // Should be dynamic and unique for CSRF
        responseMode: 'form_post', // Recommended for getting user data (name/email) securely
        // No usePopup: true here for full-page redirect
      });
      console.log('AppleID.auth initialized for redirect flow.');

      // No AppleIDSignInOnSuccess listener here because the whole page redirects.
      // The callback will be handled on the /callback page.

      // Optional: Add a click listener to confirm button interaction
      const appleButton = document.getElementById('appleid-signin');
      if (appleButton) {
        appleButton.addEventListener('click', () => {
          console.log('Apple Sign-In button clicked on home page, initiating redirect...');
        });
      }
    });
  </script>
</body>
</html>